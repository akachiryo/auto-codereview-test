name: ğŸ¯ Team Setup - Issues Batch 1

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  create-issues-batch-1:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        pip install requests pandas
        
    - name: Download project IDs
      uses: actions/download-artifact@v4
      with:
        name: project-ids
      continue-on-error: true
        
    - name: Create Issues Batch 1 (1-50)
      env:
        TEAM_SETUP_TOKEN: ${{ secrets.TEAM_SETUP_TOKEN }}
        GITHUB_REPOSITORY: ${{ github.repository }}
        BATCH_NUMBER: 1
        BATCH_SIZE: 50
      run: |
        echo "ğŸ¯ Starting Issue Creation - Batch 1 (Issues 1-50)"
        python scripts/create_issues_batch.py
        
    - name: Upload batch completion status
      uses: actions/upload-artifact@v4
      with:
        name: batch-1-status
        path: batch_1_completed.txt
        retention-days: 1
        
    - name: Wait before next batch
      run: |
        echo "â³ Waiting 30 seconds before triggering next batch..."
        sleep 30
        
    - name: Trigger Issue Creation Batch 2
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.TEAM_SETUP_TOKEN }}
        script: |
          try {
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'team-setup-issues-2.yml',
              ref: context.ref || 'main'
            });
            console.log('âœ… Triggered Issue Creation Batch 2');
            console.log('ğŸ“Š Batch 2 will create issues 51-100');
          } catch (error) {
            console.log('âš ï¸ Could not trigger Batch 2:', error.message);
            console.log('ğŸ’¡ Please manually run team-setup-issues-2.yml');
            console.log('ğŸ”— Direct link: https://github.com/' + context.repo.owner + '/' + context.repo.repo + '/actions/workflows/team-setup-issues-2.yml');
          }
        
    - name: Display batch results
      run: |
        echo "âœ¨ Batch 1 completed!"
        echo ""
        echo "ğŸ“Š Status:"
        if [ -f batch_1_completed.txt ]; then
          cat batch_1_completed.txt
        else
          echo "âŒ Batch completion file not found"
        fi
        echo ""
        echo "ğŸ”„ Next: Batch 2 (Issues 51-100) should start automatically"
        echo "ğŸ”— Monitor: https://github.com/${{ github.repository }}/actions"